<div class="dashboard-wrapper" *ngIf="!cargando; else cargandoTemplate">
    <!-- ENCABEZADO -->
    <section class="dashboard-header">
        <div class="welcome">
            <h2>{{ greeting }}, <span class="username">{{ nombre }} {{ apellido }}</span></h2>
            <p>Has acumulado <strong>{{ puntos }}</strong> puntos este mes. ¡Sigue reciclando y gana más recompensas!
            </p>
        </div>
    </section>

    <!-- CARDS PRINCIPALES -->
    <section class="cards-grid">
        <div class="card">
            <div class="icon-circle"><i class="fa-solid fa-coins"></i></div>
            <h3>{{ puntos }} Puntos</h3>
            <p>Acumulados hasta la fecha</p>
        </div>

        <div class="card">
            <div class="icon-circle"><i class="fa-solid fa-boxes-packing"></i></div>
            <h3>Última entrega</h3>
            <ng-container *ngIf="ultimaEntrega; else sinEntrega">
                <p>
                    {{ ultimaEntrega.material }} - {{ ultimaEntrega.cantidad }}
                    {{ ultimaEntrega.unidad }} ({{ ultimaEntrega.fechaEntrega | date: 'dd/MM/yyyy' }})
                </p>
            </ng-container>
            <ng-template #sinEntrega>
                <p>Aún no tienes entregas registradas</p>
            </ng-template>
        </div>

        <div class="card">
            <div class="icon-circle"><i class="fa-solid fa-seedling"></i></div>
            <h3>Impacto Ambiental</h3>
            <p>Has evitado {{ impacto | number:'1.1-1' }} kg de CO₂ emitidos</p>
        </div>

        <div class="card">
            <div class="icon-circle"><i class="fa-solid fa-gift"></i></div>
            <h3>Recompensas</h3>
            <button class="btn-cta" routerLink="../recompensas">Canjear ahora</button>
        </div>
    </section>

    <!-- GRÁFICO -->
    <section class="chart-section" *ngIf="chartData?.length">
        <div class="chart-container">
            <h3 class="section-title">Tus materiales reciclados</h3>
            <canvas #chartCanvas></canvas>
        </div>
    </section>

    <!-- ESTADÍSTICAS -->
    <section class="stats-section">
        <h3 class="section-title">Resumen de Actividad</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <h4>Entregas realizadas</h4>
                <p>{{ totalEntregas }}</p>
            </div>
            <div class="stat-item">
                <h4>Material más reciclado</h4>
                <p>{{ materialFrecuente || 'N/A' }}</p>
            </div>
            <div class="stat-item">
                <h4>Entregas aprobadas</h4>
                <p>{{ entregasAprobadas }}</p>
            </div>
        </div>
    </section>

    <!-- CAMPAÑAS -->
    <section class="campaigns-section" *ngIf="campanias.length > 0">
        <h3 class="section-title">Campañas activas</h3>
        <div class="cards-grid campaigns">
            <div class="card" *ngFor="let c of campanias">
                <div class="icon-circle"><i class="fa-solid fa-bullhorn"></i></div>
                <h3>{{ c.titulo }}</h3>
                <p>{{ c.descripcion }}</p>
                <p><strong>Ubicación:</strong> {{ c.ubicacion }}</p>
                <p><strong>Puntos Extra:</strong> +{{ c.puntosExtra }}</p>
                <p><strong>Fecha de Inicio:</strong> {{ c.fechaInicio | date:'dd/MM/yyyy' }}</p>
                <button class="btn-cta" routerLink="../campanias">Ver detalles</button>
            </div>
        </div>
    </section>

    <!-- ECO TIP -->
    <section class="eco-tip">
        <i class="fa-solid fa-leaf"></i>
        <p>¿Sabías que reciclar una botella de plástico ahorra energía suficiente para encender un foco durante 6 horas?
        </p>
    </section>
</div>

<!-- CARGA -->
<ng-template #cargandoTemplate>
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Cargando tu información...</p>
    </div>
</ng-template>